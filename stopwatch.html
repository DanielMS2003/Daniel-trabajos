<html>
<head>
    <title>Stopwatch</title>
    <link rel="stylesheet" href="https://components.digitalvalue.es/lib/semantic.min.css">
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/27/27133.png">
    <script src="https://components.digitalvalue.es/lib/mithril.min.js"></script>
    <style>
        #color-picker {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: var(--bg-color, white);
        }
    
        h1 {
            font-size: 100px;
            margin: 0;
            position: absolute;
            top: 0;
        }
    
    </style>    
<input id="color-picker" type="color" onchange="document.body.style.setProperty('--bg-color', this.value);">

<script type="text/javascript">
function updateTitle() {
    if (!document.hidden) {
        let hours = clock.hours.toString().padStart(2, '0');
        let min = clock.min.toString().padStart(2, '0');
        let sec = clock.sec.toString().padStart(2, '0');
        document.title = `${hours}:${min}:${sec} - Timer`;
    }
}

</script>

</head>    
<body>
    <h1>Stopwatch</h1>
    <div id="app"></div>

<script type="module">

function Digit() {
    let digit
    let wide
    let color

    return {
        view:(vnode)=>{
            digit=vnode.attrs.digit
            wide=vnode.attrs.wide || 15
            color=vnode.attrs.color  || "blue"
            let border=`${wide}px solid ${color}`
            return m("div",{style:"display:flex;flex-direction:column; width:100px;"},
                m("div", { style:{
                    width:"100px",
                    height:"120px",
                    ...([0,2,3,5,7,8,9].includes(digit) ? {"border-top": border} :{}),
                    ...([0,1,4,5,6,8,9].includes(digit) ? {"border-left": border} :{}),
                    ...([0,2,3,4,7,8,9].includes(digit) ? {"border-right": border} :{}),
                    ...([2,3,4,5,6,8,9].includes(digit) ? {"border-bottom": border} :{}),
                }}),
                m("div", { style:{
                    width:"100px",
                    height:"120px",
                    ...([0,1,2,6,8].includes(digit) ? {"border-left": border} :{}),
                    ...([0,3,4,5,6,7,8,9].includes(digit) ? {"border-right": border} :{}),
                    ...([0,2,3,5,6,8].includes(digit) ? {"border-bottom": border} :{}),
                }}),
            )
        }
    }
}

function Clock() {
    let hours = 0;
    let min = 0;
    let sec = 0;
    let timer;
    let isRunning = false;

    function updateTime() {
        sec++;
        if (sec == 60) {
            min++;
            sec = 0;
        }
        if (min == 60) {
            hours++;
            min = 0;
        }
        console.log(hours, min, sec);
        m.redraw();
    }

    function startTimer() {
        if (isRunning) {
            clearInterval(timer);
            isRunning = false;
            m.redraw();
        } else {
            timer = setInterval(updateTime, 1000);
            isRunning = true;
            m.redraw();
        }
    }

    function reset() {
        hours = 0;
        min = 0;
        sec = 0;
        clearInterval(timer);
        isRunning = false;
        m.redraw();
    }

    return {
    view: () => m("div", { style: "display:flex;flex-direction:column;align-items:center;" }, [
        m("div", { style: "display:flex;flex-direction:row;gap:6px;" }, [
            m(Digit, { digit: Math.floor(hours / 10) }),
            m(Digit, { digit: hours % 10 }),
            m("div", { style: "font-size: 200px; color: black; margin-top: 85px;" }, ":"),
            m(Digit, { digit: Math.floor(min / 10) }),
            m(Digit, { digit: min % 10 }),
            m("div", { style: "font-size: 200px; color: black; margin-top: 85px;" }, ":"),
            m(Digit, { digit: Math.floor(sec / 10) }),
            m(Digit, { digit: sec % 10 }),
        ]),
        m("div", { style: "display:flex;flex-direction:column;gap:6px;margin-top:20px;" }, [
            m("button", { onclick: startTimer }, isRunning ? "Pause" : "Start"),
            m("button", { onclick: reset }, "Reset"),
        ]),
    ]),
};
}

function Display() {
    let digit=4

    setInterval(()=>{digit=(digit+1)%10;m.redraw()},1000)
    return {
        view:()=>{
            return m("div",{style:"display:flex;flex-direction:row;gap:6px;"},[
                m(Digit,{digit:0,color:"red"}),
                m(Digit,{digit:1}),
                m(Digit,{digit:2}),
                m(Digit,{digit:3,color:"red"}),
                m(Digit,{digit:4}),
                m(Digit,{digit:5}),
                m(Digit,{digit:6}),
                m(Digit,{digit:7,color:"red"}),
                m(Digit,{digit:8}),
                m(Digit,{digit:9}),
                m(Digit,{digit:digit})
            ])    
        }
    }
}

m.mount(document.getElementById("app"), Clock);

</script>
</html>